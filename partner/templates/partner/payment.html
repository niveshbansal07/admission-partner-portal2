{% extends "base.html" %}
{% block content %}

<div class="dashboard">
    <aside class="sidebar">
        <div class="user-box">
            <div>
                <div class="name">Welcome</div>
                <span>{{ partner_name }}</span>
            </div>
        </div>

        <ul>
            <li>
                <a href="/partner/dashboard">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                        class="bi bi-border-style" viewBox="0 0 16 16">
                        <path
                            d="M1 3.5a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5zm0 4a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-5a.5.5 0 0 1-.5-.5zm0 4a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm8 0a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm-4 0a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm8 0a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm-4-4a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-5a.5.5 0 0 1-.5-.5z" />
                    </svg>
                    Dashboard
                </a>
            </li>
            <li>
                <a href="/partner/create_lead">
                    <svg viewBox="0 0 24 24" fill="none">
                        <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                    </svg>
                    Create Lead
                </a>
            </li>

            <li>
                <a href="/partner/payment">
                    <!-- WALLET SVG -->
                    <svg viewBox="0 0 24 24" fill="none">
                        <path d="M3 7h18v10H3z" stroke="currentColor" stroke-width="2" />
                        <path d="M16 12h2" stroke="currentColor" stroke-width="2" />
                    </svg>
                    Payment Status
                </a>
            </li>

            <li>
                <a href="/report/partner">
                    <!-- REPORT SVG -->
                    <svg viewBox="0 0 24 24" fill="none">
                        <path d="M4 4h16v16H4z" stroke="currentColor" stroke-width="2" />
                        <path d="M8 16v-4M12 16v-7M16 16v-2" stroke="currentColor" stroke-width="2" />
                    </svg>
                    Reports
                </a>
            </li>

            <li>
                <a href="/partner/profile">
                    <!-- USER SVG -->
                    <svg viewBox="0 0 24 24" fill="none">
                        <circle cx="12" cy="8" r="4" stroke="currentColor" stroke-width="2" />
                        <path d="M4 20c0-4 4-6 8-6s8 2 8 6" stroke="currentColor" stroke-width="2" />
                    </svg>
                    Profile
                </a>
            </li>
        </ul>

    </aside>
    <main class="main">

        <div class="table">
            <table>
                <thead>
                    <tr>
                        <th>Student Name</th>
                        <th>Lead ID</th>
                        <th>Amount (₹)</th>
                        <th>Status</th>
                        <th>Release Date</th>
                    </tr>
                </thead>
                <tbody id="payment-table">
                    <tr>
                        <td colspan="5" class="loading">Loading payments...</td>
                    </tr>
                </tbody>
            </table>
        </div>

    </main>
</div>
<script>
    fetch("/partner/api/payment", { credentials: "include" })

        .then(res => {
            if (res.status === 401) {
                window.location.href = "/auth/login";
                return;
            }
            return res.json();
        })

        .then(data => {
            const table = document.getElementById("payment-table");
            table.innerHTML = "";

            if (data.length === 0) {
                table.innerHTML = `<tr><td colspan="5">No payments found</td></tr>`;
                return;
            }

            data.forEach(p => {
                table.innerHTML += `
            <tr>
                <td>${p.student_name}</td>
                <td>#${p.lead_id}</td>
                <td>₹${p.amount}</td>
                <td>
                    <span class="badge ${p.status === 'Released' ? 'success' : 'pending'}">
                        ${p.status}
                    </span>
                </td>
                <td>${p.release_date ?? '-'}</td>
            </tr>
        `;
            });
        })

        .catch(() => {
            document.getElementById("payment-table").innerHTML =
                `<tr><td colspan="5">Session expired. Please login again.</td></tr>`;
        });
</script>

{% endblock %}